## 入门

### 非对称加密

* 公开密钥加密（public-key cryptography），也称为非对称加密（asymmetric cryptography），一种密码学算法类型，在这种密码学方法中需要一对密钥，一是个私人密钥，另一个则是公开密钥。
* 这两个密钥是数学相关，用某用户密钥加密后所得的信息，只能用该用户的解密密钥才能解密。
* **知道了其中一个，并不能计算出另外一个**。因此如果公开了一对密钥中的一个，并不会危害到另外一个的秘密性质。称公开的密钥为公钥；不公开的密钥为私钥。
* 如果加密密钥是公开的，这用于客户给私钥所有者上传加密的数据，这被称作为公开密钥加密(狭义)。
* 如果解密密钥是公开的，用私钥加密的信息，可以用公钥对其解密，用于客户验证持有私钥一方发布的数据或文件是完整准确的，接收者由此可知这条信息确实来自于拥有私钥的某人，这被称作**数字签名**，公钥的形式就是**数字证书**。
* 常见的公钥加密算法有: RSA、ElGamal、背包算法、Rabin（RSA的特例）、Diffie-Hellman密钥交换协议中的公钥加密算法、椭圆曲线加密算法（Elliptic Curve Cryptography, ECC）。
* 使用最广泛的是RSA算法（1977年，三位数学家Rivest、Shamir和Adleman设计了的算法）是著名的公钥加密算法。

### 优点

* 与对称密钥加密（通用的算法为DES，Data Encryption Standard）相比，优点在于无需共享的通用密钥，解密的私钥不发往任何用户。
* 即使公钥在网上被截获，如果没有与其匹配的私钥，也无法解密，所截获的公钥没有任何用处。

### 过程

* 假设两个用户A向B发送信息。B的公钥为`c`，对应私钥（也是属于B的）为`d`，明文为`x`。
  * A用公钥对明文进行加密形成密文`c(x)`，然后传输密文；
  * B收到密文，用私钥对密文进行解密`d(c(x))`,得到要通信的明文`x`。
* B向A发送信息反之。

## 进阶

### RSA算法

* RSA算法非常可靠，密钥越长，它就越难破解。根据已经披露的文献，目前被破解的最长RSA密钥是768个二进制位。也就是说，长度超过768位的密钥，还无法破解（至少没人公开宣布）。因此可以认为，1024位的RSA密钥基本安全，2048位的密钥极其安全。
  * RSA算法的核心是欧拉定理。
* 有无可能在已知n和e的情况下，推导出私钥？
  * 大整数的因数分解。
  * 非常困难。目前除了暴力破解，还没有发现别的有效方法。
  * wikipedia这样写，
    * 对极大整数做因数分解的难度决定了RSA算法的可靠性。换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。
    * 假如有人找到一种快速因数分解的算法，那么RSA的可靠性就会极度下降。但找到这样的算法的可能性是非常小的。今天只有短的RSA密钥才可能被暴力破解。到2008年为止，世界上还没有任何可靠的攻击RSA算法的方式。
    * 只要密钥长度足够长，用RSA加密的信息实际上是不能被解破的。
* 公钥用来加密信息，私钥用来数字签名。换句话说，用私钥来加密数据，用途就是数字签名，用公钥来验证数字签名。
* 为了防止有人散布伪造的公钥骗取信任，就需要一个可靠的第三方机构来生成经过认证的（公钥，私钥）对。目前，世界上最主要的数字服务认证商是位于美国加州的Verisign公司，它的主要业务就是分发RSA数字证书。

## Android App签名

* 必须使用私钥签名，应用才能发布。
  * 数字签名技术是将信息摘要用发送者的私钥加密，和原文以及公钥一起传送给接收者。
  * 接收者只有用发送者的公钥才能解密被加密的信息摘要，然后接收者用相同的Hash函数对收到的原文产生一个信息摘要，与解密的信息摘要做比对。
  * 如果相同，则说明收到的信息是完整的，在传输过程中没有被修改；
  * 不同则说明信息被修改过。
  * 还可以确定信息一定是发送者发送的。

### 工具

* keytool，创建一个密钥证书存储文件和一个私钥。
* jarsigner，用keytool产生的私钥为apk文件签名。
* signapk.jar，Android自带的签名工具。
* .pk8文件是私钥文件。
* x509.pem文件是公钥文件。

### META-INF

* 比较`MANIFEST.MF`和`CERT.SF`文件可见，`CERT.SF`比`MANIFEST.MF`多一个`SHA1-Digest-Manifest`值，这个值其实是`MANIFEST.MF`文件的SHA1并base64编码的值。之后对`MANIFEST.MF`中的每一项再次SHA1并base64编码。
* 而`MANIFEST.MF`文件中的每一项是什么？是把每一个文件的SHA-1哈希值（摘要，也有用128位的MD5算法，SHA-1是160位的）做base64编码。
* `CERT.RSA`是PKCS7格式的文件，可以用如下命令提取公钥。

      openssl pkcs7 -inform DER -in CERT.RSA -noout -print_certs -text
